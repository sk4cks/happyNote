---
title: 'ğŸ›ï¸[ìŠ¤í”„ë§ ì‹œíë¦¬í‹° OAuth2] Spring Authorization Server - ì—”ë“œí¬ì¸íŠ¸ í”„ë¡œí† ì½œ'
date: 2025-10-19
tags: ['springboot', 'spring-security', 'authorization-server']
draft: false
layout: PostSimple
---

# ëª©ì°¨

<TOCInline toc={props.toc} exclude="ëª©ì°¨"/>

---

# 1. OAuth 2.0 AuthorizationServer Endpoint

## 1-1. ê¸°ëŠ¥ ë° íŠ¹ì§•

### âœ“ OAuth2AuthorizationEndpointConfigurer

- OAuth2 ê¶Œí•œ ë¶€ì—¬ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ì‚¬ìš©ì ì •ì˜ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- OAuth2 ê¶Œí•œ ë¶€ì—¬ ìš”ì²­ì— ëŒ€í•œ ì „ì²˜ë¦¬, ê¸°ë³¸ ì²˜ë¦¬ ë° í›„ì²˜ë¦¬ ë¡œì§ì„ ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ APIë¥¼ ì§€ì›í•œë‹¤
- OAuth2AuthorizationEndpointFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤

### âœ“ OAuth2AuthorizationEndpointFilter

- OAuth2 ì¸ì¦ ìš”ì²­(ë° ë™ì˜)ì„ ì²˜ë¦¬í•˜ëŠ” í•„í„°ì´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ êµ¬ì„±ëœë‹¤
- **OAuth2AuthorizationCodeRequestAuthenticationConverter** â€“ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ OAuth2AuthorizationCodeRequestAuthenticationToken ìœ¼ë¡œ ë³€í™˜í•˜ê³  AuthenticationProvider ì—ê²Œ ì „ë‹¬í•œë‹¤
- **OAuth2AuthorizationCodeRequestAuthenticationProvider**
  - Authorization Code ê¶Œí•œ ë¶€ì—¬ ë°©ì‹ì„ ì²˜ë¦¬í•˜ëŠ” OAuth 2.0 ì¸ì¦ ìš”ì²­ ë° ë™ì˜ì— ëŒ€í•œ AuthenticationProvider êµ¬í˜„ì²´ì´ë‹¤

### âœ“ RequestMatcher

- **Code ìš”ì²­ íŒ¨í„´**
  - /oauth2/authorize, GET, /oauth2/authorize, POST
- **Consent (ë™ì˜í•˜ê¸°) ìš”ì²­ íŒ¨í„´**
  - /oauth2/authorize, POST

### âœ“ ì‚¬ìš©ì ì •ì˜ ê¸°ëŠ¥

```java
@Bean
public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
	OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer =
		new OAuth2AuthorizationServerConfigurer<>();
	http.apply(authorizationServerConfigurer);
	
	authorizationServerConfigurer
		.authorizationEndpoint(authorizationEndpoint ->
			authorizationEndpoint
				.authorizationRequestConverter(authorizationRequestConverter)
				.authenticationProvider(authenticationProvider)
				.authorizationResponseHandler(authorizationResponseHandler)
				.errorResponseHandler(errorResponseHandler)
				.consentPage("/oauth2/v1/authorize")	// ê¶Œí•œ ë¶€ì—¬ ìš”ì²­ íë¦„ ì¤‘ì— ìŠ¹ì¸ì´ í•„ìš”í•œ ê²½ìš° ë¦¬ì†ŒìŠ¤ ì†Œìœ ìë¥¼ ë¦¬ë‹¤ì´ë ‰ì…˜í•˜ëŠ” ì‚¬ìš©ì ì§€ì • ë™ì˜ í˜ì´ì§€ì˜ URI
		);
		
	return http.build();
}
```

## 1-2. Endpoint Flow & ì•„í‚¤í…ì²˜

### 1-2-1. ê°œìš”

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000053.png`} />

### 1-2-2. ì¸ì¦ ì „ ë‹¨ê³„

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000054.png`} />

### 1-2-3. ì¸ì¦ ë° ë™ì˜(Consent) ë‹¨ê³„

**âœ“ OAuth2AuthorizationConsent**

- OAuth2AuthorizationConsent ëŠ” OAuth2 ê¶Œí•œ ë¶€ì—¬ ìš”ì²­ íë¦„ì˜ ê¶Œí•œë¶€ì—¬"ë™ì˜â€œ (ê²°ì •)ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ìŠ¹ì¸í•  ë•Œ ë¦¬ì†ŒìŠ¤ ì†Œìœ ìëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•œ ê¶Œí•œì˜ í•˜ìœ„ ì§‘í•©ë§Œ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ê°€ ë²”ìœ„ë¥¼ ìš”ì²­í•˜ê³  ë¦¬ì†ŒìŠ¤ ì†Œìœ ìê°€ ìš”ì²­ëœ ë²”ìœ„ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•˜ê±°ë‚˜ ê±°ë¶€í•˜ëŠ” authorization_code grant íë¦„ì´ë‹¤
- OAuth2 ì¸ì¦ ìš”ì²­ íë¦„ì´ ì™„ë£Œë˜ë©´ OAuth2 Authorization Consentê°€ ìƒì„±(ë˜ëŠ” ì—…ë°ì´íŠ¸)ë˜ê³  ë¶€ì—¬ëœ ê¶Œí•œì„ í´ë¼ì´ì–¸íŠ¸ ë° ë¦¬ì†ŒìŠ¤ ì†Œìœ ìì™€ ì—°ê²°í•œë‹¤.
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000055.png`} />

**âœ“ OAuth2AuthorizationConsentService**

- OAuth2AuthorizationConsent ì €ì¥ë˜ê³  ê¸°ì¡´ OAuth2AuthorizationConsent ë¥¼ ì¡°íšŒí•˜ëŠ” í´ë˜ìŠ¤ë¡œ ì£¼ë¡œ OAuth2 ê¶Œí•œ ë¶€ì—¬ ìš”ì²­ íë¦„ì„ êµ¬í˜„í•˜ëŠ” êµ¬ì„± ìš”ì†Œì— ì˜í•´ ì‚¬ìš©ëœë‹¤
- ê¸°ë³¸ êµ¬í˜„ì²´ëŠ” InMemoryOAuth2AuthorizationConsentService ì™€ JdbcOAuth2AuthorizationConsentService ê°€ ìˆë‹¤
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000056.png`} />

**âœ“ Resource owner ì¸ì¦ ë° Scope ë™ì˜ ë‹¨ê³„- 1**

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000057.png`} />

**âœ“ Resource owner ì¸ì¦ ë° Scope ë™ì˜ ë‹¨ê³„- 2**

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000058.png`} />

---

# 2. OAuth 2.0 Token Endpoint

## 2-1. ê¸°ëŠ¥ ë° íŠ¹ì§•

### âœ“ OAuth2TokenEndpointConfigurer

- OAuth2 í† í° ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ì‚¬ìš©ì ì •ì˜ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- OAuth2 í† í° ìš”ì²­ì— ëŒ€í•œ ì „ì²˜ë¦¬, ê¸°ë³¸ ì²˜ë¦¬ ë° í›„ì²˜ë¦¬ ë¡œì§ì„ ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ APIë¥¼ ì§€ì›í•œë‹¤
- OAuth2TokenEndpointFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤
- ì§€ì›ë˜ëŠ” ê¶Œí•œ ë¶€ì—¬ ìœ í˜•ì€ authorization_code, refresh_token ë° client_credential ì´ë‹¤

### âœ“ OAuth2TokenEndpointFilter

- í´ë¼ì´ì–¸íŠ¸ì˜ í† í° ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•„í„°ì´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ êµ¬ì„±ëœë‹¤
- **DelegatingAuthenticationConverter** â€“ ê° íŠ¹ì • ìœ í˜•ì˜ AuthenticationConverter ë¥¼ í˜¸ì¶œí•´ì„œ ì²˜ë¦¬ë¥¼ ìœ„ì„í•œë‹¤
  - OAuth2AuthorizationCodeAuthenticationConverter â€“ HttpServletRequest ì •ë³´ë¥¼ OAuth2AuthorizationCodeAuthenticationToken ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
  - OAuth2RefreshTokenAuthenticationConverter - HttpServletRequest ì •ë³´ë¥¼ OAuth2RefreshTokenAuthenticationToken ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
  - OAuth2ClientCredentialsAuthenticationConverter - HttpServletRequest ì •ë³´ë¥¼ OAuth2ClientCredentialsAuthenticationToken ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
- **OAuth2AuthorizationCodeAuthenticationProvider, OAuth2RefreshTokenAuthenticationProvider, OAuth2ClientCredentialsAuthenticationProvider**
  - ê¶Œí•œ ë¶€ì—¬ ìœ í˜•ì— ë”°ë¼ í† í°ì„ ë°œí–‰í•˜ëŠ” AuthenticationProvider êµ¬í˜„ì²´ì´ë‹¤
- **AuthenticationSuccessHandler** - ì¸ì¦ëœ OAuth2AccessTokenAuthenticationToken ì„ ì²˜ë¦¬í•˜ëŠ” ë‚´ë¶€ êµ¬í˜„ì²´ë¡œì„œ ì¸ì¦í† í°ì„ ì‚¬ìš©í•˜ì—¬ OAuth2AccessTokenResponse ë¥¼ ë°˜í™˜í•œë‹¤.
- **AuthenticationFailureHandler** - OAuth2AuthenticationException ê³¼ ê´€ë ¨ëœ OAuth2Errorë¥¼ ì‚¬ìš©í•˜ëŠ” ë‚´ë¶€ êµ¬í˜„ ì¸ì¦ì˜ˆì™¸ì´ë©° OAuth2Error ì‘ë‹µì„ ë°˜í™˜í•œë‹¤.

### âœ“ RequestMatcher

- **í† í° ìš”ì²­ íŒ¨í„´**
  - /oauth2/token, POST

### âœ“ ì‚¬ìš©ì ì •ì˜ ê¸°ëŠ¥

```java
@Bean
public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
	OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer =
		new OAuth2AuthorizationServerConfigurer<>();
	http.apply(authorizationServerConfigurer);
	
	authorizationServerConfigurer
		.tokenEndpoint(tokenEndpoint ->
			tokenEndpoint
				.accessTokenRequestConverter(accessTokenRequestConverter)
				.authenticationProvider(authenticationProvider)
				.accessTokenResponseHandler(accessTokenResponseHandler)
				.errorResponseHandler(errorResponseHandler)
		);
	
	return http.build();
}
```

## 2-2. Flow & ì•„í‚¤í…ì²˜

### 2-2-1. í´ë¼ì´ì–¸íŠ¸ ì¸ì¦í•˜ê¸°

**âœ“ OAuth2ClientAuthenticationConfigurer**

- OAuth2 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„ ìœ„í•œ ì‚¬ìš©ì ì •ì˜í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ìš”ì²­ì— ëŒ€í•œ ì „ì²˜ë¦¬, ê¸°ë³¸ ì²˜ë¦¬ ë° í›„ì²˜ë¦¬ ë¡œì§ì„ ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ APIë¥¼ ì§€ì›í•œë‹¤
- OAuth2ClientAuthenticationFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤
- ì§€ì›ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ë°©ë²•ì€ client_secret_basic, client_secret_post, private_key_jwt, client_secret_jwtë° none(ê³µê°œ í´ë¼ì´ì–¸íŠ¸) ì´ë‹¤

**âœ“ OAuth2ClientAuthenticationFilter**

- í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•„í„°ì´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ êµ¬ì„±ëœë‹¤
- **DelegatingAuthenticationConverter**
  - ClientSecretBasicAuthenticationConverter â€“ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë°©ì‹ì´ HTTP Basic ì¼ ê²½ìš° ì²˜ë¦¬
  - ClientSecretPostAuthenticationConverter â€“ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë°©ì‹ì´ POST ì¼ ê²½ìš° ì²˜ë¦¬
  - JwtClientAssertionAuthenticationConverter - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë°©ì‹ì´ JWT í† í°ì¼ ê²½ìš° ì²˜ë¦¬
  - PublicClientAuthenticationConverter - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë°©ì‹ì´ PKCE ì¼ ê²½ìš° ì²˜ë¦¬
- **DelegatingAuthenticationProvider**
  - ClientSecretAuthenticationProvider, JwtClientAssertionAuthenticationProvider, PublicClientAuthenticationProvider
  - ê¶Œí•œ ë¶€ì—¬ ìœ í˜•ì— ë”°ë¼ í† í°ì„ ë°œí–‰í•˜ëŠ” AuthenticationProvider êµ¬í˜„ì²´ì´ë‹¤
- AuthenticationSuccessHandler - ì¸ì¦ëœ OAuth2ClientAuthenticationToken ì— SecurityContext ë¥¼ ì—°ê²°í•˜ëŠ” ë‚´ë¶€ êµ¬í˜„ì²´
- AuthenticationFailureHandler â€“ ì—°ê²°ëœ OAuth2AuthenticationException ë¥¼ ì‚¬ìš©í•˜ì—¬ OAuth2 ì˜¤ë¥˜ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ë‚´ë¶€ êµ¬í˜„ì²´

**âœ“ RequestMatcher**

- **í† í° ìš”ì²­ íŒ¨í„´**
  - POST /oauth2/token, POST /oauth2/introspect, POST /oauth2/revoke

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000059.png`} />

**âœ“ ì‚¬ìš©ì ì •ì˜ ê¸°ëŠ¥**

```java
@Bean
public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
	OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer =
		new OAuth2AuthorizationServerConfigurer<>();
	http.apply(authorizationServerConfigurer);
	
	authorizationServerConfigurer
		.clientAuthentication(clientAuthentication ->
			clientAuthentication.authenticationConverter(authenticationConverter)
				.authenticationProvider(authenticationProvider)
				.authenticationSuccessHandler(authenticationSuccessHandler)
				.errorResponseHandler(errorResponseHandler)
		);
	
	return http.build();
}
```

### 2-2-2. Authorization Code Grant Type

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000060.png`} />

**âœ“ Access Token Response**

- **Successful Response**
  - access_token(<span style={{color: 'red'}}>í•„ìˆ˜</span>) - ê¶Œí•œ ë¶€ì—¬ ì„œë²„ì—ì„œ ë°œê¸‰í•œ ì•¡ì„¸ìŠ¤ í† í° ë¬¸ìì—´
  - token_type(<span style={{color: 'red'}}>í•„ìˆ˜</span>) - í† í° ìœ í˜•ì€ ì¼ë°˜ì ìœ¼ë¡œ "Bearer" ë¬¸ìì—´
  - expires_in(<span style={{color: 'blue'}}>ê¶Œì¥</span>) â€“ í† í°ì˜ ë§Œë£Œì‹œê°„
  - refresh_token(ì„ íƒ ì‚¬í•­) - ì•¡ì„¸ìŠ¤ í† í°ì´ ë§Œë£Œë˜ë©´ ì‘ìš© í”„ë¡œê·¸ë¨ì´ ë‹¤ë¥¸ ì•¡ì„¸ìŠ¤ í† í°ì„ ì–»ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” Refresh í† í°ì„ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ìœ ìš©í•˜ë‹¤.
    - ë‹¨, implicit ê¶Œí•œ ë¶€ì—¬ë¡œ ë°œí–‰ëœ í† í°ì€ ìƒˆë¡œê³ ì¹¨ í† í°ì„ ë°œí–‰í•  ìˆ˜ ì—†ë‹¤.
  - scope(ì„ íƒì‚¬í•­) - ì‚¬ìš©ìê°€ ë¶€ì—¬í•œ ë²”ìœ„ê°€ ì•±ì´ ìš”ì²­í•œ ë²”ìœ„ì™€ ë™ì¼í•œ ê²½ìš° ì´ ë§¤ê°œë³€ìˆ˜ëŠ” ì„ íƒì‚¬í•­.
  <img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000061.png`} />
- **Unsuccessful Response**
  - invalid_request - ìš”ì²­ì— ë§¤ê°œë³€ìˆ˜ê°€ ëˆ„ë½, ì§€ì›ë˜ì§€ ì•ŠëŠ” ë§¤ê°œë³€ìˆ˜, ë§¤ê°œë³€ìˆ˜ ë°˜ë³µë˜ëŠ” ê²½ìš° ì„œë²„ê°€ ìš”ì²­ì„ ì§„í–‰í•  ìˆ˜ ì—†ìŒ
  - invalid_client - ìš”ì²­ì— ì˜ëª»ëœ í´ë¼ì´ì–¸íŠ¸ ID ë˜ëŠ” ì•”í˜¸ê°€ í¬í•¨ëœ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì— ì‹¤íŒ¨, <span style={{color: 'blue'}}>HTTP 401 ì‘ë‹µ</span>
  - invalid_grant - ì¸ì¦ ì½”ë“œê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œë¨
    - ê¶Œí•œ ë¶€ì—¬ì— ì œê³µëœ ë¦¬ë””ë ‰ì…˜ URLì´ ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­ì— ì œê³µëœ URLê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë°˜í™˜í•˜ëŠ” ì˜¤ë¥˜
  - invalid_scope - ë²”ìœ„ë¥¼ í¬í•¨í•˜ëŠ” ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­ì˜ ê²½ìš° ì´ ì˜¤ë¥˜ëŠ” ìš”ì²­ì˜ ìœ íš¨í•˜ì§€ ì•Šì€ ë²”ìœ„ ê°’ì„ ë‚˜íƒ€ëƒ„
  - unauthorized_client - ì´ í´ë¼ì´ì–¸íŠ¸ëŠ” ìš”ì²­ëœ ê¶Œí•œ ë¶€ì—¬ ìœ í˜•ì„ ì‚¬ìš©í•  ê¶Œí•œì´ ì—†ìŒ(RegisteredClient ì— ì •ì˜í•˜ì§€ ì•Šì€ ê¶Œí•œ ë¶€ì—¬ ìœ í˜•ì„ ìš”ì²­í•œ ê²½ìš°)
  - unsupported_grant_type - ê¶Œí•œ ë¶€ì—¬ ì„œë²„ê°€ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ìŠ¹ì¸ ìœ í˜•ì„ ìš”ì²­í•˜ëŠ” ê²½ìš° ì´ ì½”ë“œë¥¼ ì‚¬ìš©í•¨
  <img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000062.png`} />

### 2-2-3. Client Credentials Grant Type

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000063.png`} />

### 2-2-4. Refresh Token Flow

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000064.png`} />

### 2-2-5. Authorization Code with PKCE Grant Type

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000065.png`} />
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000066.png`} />
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000067.png`} />

---

# 3. OAuth 2.0 Token Introspection Endpoint

## âœ“ OAuth2TokenIntrospectionEndpointConfigurer

- OAuth2 í† í° ê²€ì‚¬ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ì‚¬ìš©ì ì •ì˜ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- OAuth2 ê²€ì‚¬ ìš”ì²­ì— ëŒ€í•œ ì „ì²˜ë¦¬, ê¸°ë³¸ ì²˜ë¦¬ ë° í›„ì²˜ë¦¬ ë¡œì§ì„ ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ APIë¥¼ ì§€ì›í•œë‹¤
- OAuth2TokenIntrospectionEndpointFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤

## âœ“ OAuth2TokenIntrospectionEndpointFilter

- OAuth2 ê²€ì‚¬ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•„í„°ì´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ êµ¬ì„±ëœë‹¤
- **IntrospectionRequestConverter**
  - OAuth2 ê²€ì‚¬ ìš”ì²­ì„ ì¶”ì¶œí•˜ë ¤ê³  í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì „ì²˜ë¦¬ê¸°ë¡œì„œ OAuth2TokenIntrospectionAuthenticationToken ì„ ë°˜í™˜í•œë‹¤
- **OAuth2TokenIntrospectionAuthenticationProvider**
  - OAuth2TokenIntrospectionAuthenticationToken ë¥¼ ë°›ì•„ ì¸ì¦ ì²˜ë¦¬ë¥¼ í•˜ëŠ” AuthenticationProvider êµ¬í˜„ì²´ì´ë‹¤

## âœ“ RequestMatcher

- **í† í° ê²€ì‚¬ ìš”ì²­ íŒ¨í„´**
  - /oauth2/introspect, POST

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000068.png`} />

## âœ“ ì‚¬ìš©ì ì •ì˜ ê¸°ëŠ¥

```java
@Bean
public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
	OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer =
		new OAuth2AuthorizationServerConfigurer<>();
	http.apply(authorizationServerConfigurer);
	
	authorizationServerConfigurer
		.tokenIntrospectionEndpoint(tokenIntrospectionEndpoint ->
			tokenIntrospectionEndpoint
				.introspectionRequestConverter(introspectionRequestConverter)
				.authenticationProvider(authenticationProvider)
				.introspectionResponseHandler(introspectionResponseHandler)
				.errorResponseHandler(errorResponseHandler)
		);
	
	return http.build();
}
```

# 4. OAuth 2.0 Token Revocation Endpoint

## âœ“ OAuth2TokenRevocationEndpointConfigurer

- OAuth2 í† í° ì·¨ì†Œ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ì‚¬ìš©ì ì •ì˜ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- OAuth2 í† í° ì·¨ì†Œì— ëŒ€í•œ ì „ì²˜ë¦¬, ê¸°ë³¸ ì²˜ë¦¬ ë° í›„ì²˜ë¦¬ ë¡œì§ì„ ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ APIë¥¼ ì§€ì›í•œë‹¤
- OAuth2TokenRevocationEndpointFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤

## âœ“ OAuth2TokenRevocationEndpointFilter

- OAuth2 í† í° ì·¨ì†Œë¥¼ ì²˜ë¦¬í•˜ëŠ” í•„í„°ì´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ êµ¬ì„±ëœë‹¤
- **DefaultTokenRevocationAuthenticationConverter**
  - OAuth2 í† í° ì·¨ì†Œë¥¼ ì¶”ì¶œí•˜ë ¤ê³  í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì „ì²˜ë¦¬ê¸°ë¡œì„œ OAuth2TokenRevocationAuthenticationToken ì„ ë°˜í™˜í•œë‹¤
- **OAuth2TokenRevocationAuthenticationProvider**
  - OAuth2TokenRevocationAuthenticationToken ì„ ì „ë‹¬ë°›ì•„ ì¸ì¦ì²˜ë¦¬ë¥¼ í•˜ëŠ” AuthenticationProvider êµ¬í˜„ì²´ì´ë‹¤.

## âœ“ RequestMatcher

- **í† í° ì·¨ì†Œ ìš”ì²­ íŒ¨í„´**
  - /oauth2/revoke, POST

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000069.png`} />

## âœ“ ì‚¬ìš©ì ì •ì˜ ê¸°ëŠ¥

```java
@Bean
public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
	OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer =
		new OAuth2AuthorizationServerConfigurer<>();
	http.apply(authorizationServerConfigurer);
	
	authorizationServerConfigurer
		.tokenRevocationEndpoint(tokenRevocationEndpoint ->
			tokenRevocationEndpoint
				.revocationRequestConverter(revocationRequestConverter)
				.authenticationProvider(authenticationProvider)
				.revocationResponseHandler(revocationResponseHandler)
				.errorResponseHandler(errorResponseHandler)
		);
	
	return http.build();
}
```

# 5. OAuth 2.0 Authorization Server Metadata Endpoint

## âœ“ OAuth2AuthorizationServerConfigurer

- OAuth2 Authorization Server ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ ëŒ€í•œ ì§€ì›ì„ ì œê³µí•œë‹¤.
- OAuth2AuthorizationServerMetadataEndpointFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤
- OAuth2 Authorization Server ë©”íƒ€ë°ì´í„° ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  OAuth2 Authorization Server ë©”íƒ€ë°ì´í„° ì‘ë‹µì„ ë°˜í™˜í•œë‹¤
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000070.png`} />

## âœ“ RequestMatcher

- **í† í° ê²€ì‚¬ ìš”ì²­ íŒ¨í„´**
  - /.well-known/oauth-authorization-server, GET

# 6. JWK Set Endpoint

## âœ“ OAuth2AuthorizationServerConfigurer

- JWK Set ì—”ë“œí¬ì¸íŠ¸ ëŒ€í•œ ì§€ì›ì„ ì œê³µí•œë‹¤.
- NimbusJwkSetEndpointFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤
- NimbusJwkSetEndpointFilter ëŠ” JWK Set ì„ ë°˜í™˜í•˜ëŠ” í•„í„°ì…ë‹ˆë‹¤.
- JWK Set ì—”ë“œí¬ì¸íŠ¸ëŠ” JWKSource\<SecurityContext\> ë¹ˆì´ ë“±ë¡ëœ ê²½ìš°ì—ë§Œ êµ¬ì„±ë©ë‹ˆë‹¤

## âœ“ RequestMatcher

- **í† í° ê²€ì‚¬ ìš”ì²­ íŒ¨í„´**
  - /oauth2/jwks, GET
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000071.png`} />
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000072.png`} />

# 7. OpenID Connect 1.0 Endpoint

## âœ“ OpenID Connect 1.0 Provider Configuration Endpoint

- OidcConfigurer ëŠ” OpenID Connect 1.0 Provider Configuration ì—”ë“œí¬ì¸íŠ¸ ëŒ€í•œ ì§€ì›ì„ ì œê³µí•œë‹¤.
- OidcConfigurer ëŠ” OidcProviderConfigurationEndpointFilter ë¥¼ êµ¬ì„±í•˜ê³  ì´ë¥¼ OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤
- OidcProviderConfigurationEndpointFilter ëŠ” OidcProviderConfiguration ì‘ë‹µì„ ì²˜ë¦¬í•œë‹¤

## âœ“ OpenID Connect 1.0 UserInfo Endpoint

- OidcUserInfoEndpointConfigurer ëŠ” OpenID Connect 1.0 UserInfo ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©ì ì •ì˜í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤
- OidcUserInfoEndpointFilterë¥¼ êµ¬ì„±í•˜ê³  OAuth2 ì¸ì¦ ì„œë²„ SecurityFilterChain ë¹ˆì— ë“±ë¡í•œë‹¤

## âœ“ OidcUserInfoEndpointFilter

- UserInfo ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  OidcUserInfo ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” í•„í„°ì´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ êµ¬ì„±ëœë‹¤
- **OidcUserInfoAuthenticationProvider**
  - ìš”ì²­ëœ scope ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ID í† í°ì—ì„œ í‘œì¤€ í´ë ˆì„ì„ ì¶”ì¶œí•˜ëŠ” userInfoMapper ì„ ê°€ì§€ê³  ìˆë‹¤

## âœ“ RequestMatcher

- **í† í° ê²€ì‚¬ ìš”ì²­ íŒ¨í„´**
  - /userinfo, POST
  - /userinfo, GET

## âœ“ UserInfo ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì¡°ê±´

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000073.png`} />
- UserInfo ì—”ë“œí¬ì¸íŠ¸ í”„ë¡œí† ì½œì€ ê¸°ë³¸ì ìœ¼ë¡œ ì¸ì¦ì„ ë°›ì€ ìƒíƒœì—ì„œë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•œë‹¤. ì™œëƒí•˜ë©´ FilterSecurityInteceptor í´ë˜ìŠ¤ ì´í›„ì— ìœ„ì¹˜í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤
- UserInfo ì—”ë“œí¬ì¸íŠ¸ ìš”ì²­ì‹œ ì¼ë°˜ì ìœ¼ë¡œ ë¡œê·¸ì¸ ê³¼ì •ì„ ê±°ì¹˜ê¸° ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ access token ë°œê¸‰ì´ ê°€ëŠ¥í•˜ë‹¤
- /userinfo ì—”ë“œí¬ì¸íŠ¸ëŠ” ê¶Œí•œë¶€ì—¬íë¦„ ìš”ì²­ì—ì„œ ë°›ì€ access token ì„ ê°€ì§€ê³  ì¸ê°€ì„œë²„ë¡œ ìš”ì²­í•˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ì¸ì¦ê³¼ì •ì„ ê±°ì¹˜ë„ë¡ êµ¬ì„±ë˜ì–´ì ¸ì•¼ í•œë‹¤

## âœ“ UserInfo ì—”ë“œ í¬ì¸íŠ¸ ë³´í˜¸ ìì› êµ¬ì„±

```java
@Bean
public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
	OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer =
		new OAuth2AuthorizationServerConfigurer<>();
	http.apply(authorizationServerConfigurer);
	...
	
	http.oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt);
	
	return http.build();
}

@Bean
public JwtDecoder jwtDecoder(JWKSource<SecurityContext> jwkSource) {
	return OAuth2AuthorizationServerConfiguration.jwtDecoder(jwkSource);
}
```

- http.oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt) êµ¬ì„±ì„ í†µí•´ í† í°ì— ëŒ€í•œ ì¸ì¦ê³¼ì •ì„ ê±°ì¹˜ë„ë¡ í•œë‹¤
- UserInfo ë¦¬ì†ŒìŠ¤ëŠ” FilterSecurityInterceptor ì—ì„œ ê¶Œí•œì´ í—ˆê°€ëœ ì´í›„ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ìœ„ì¹˜í•´ ìˆë‹¤.
- OpenID Connect 1.0 UserInfo ì—”ë“œí¬ì¸íŠ¸ì—ëŠ” í† í°ì„ ë””ì½”ë”©í•˜ê³  ê²€ì¦í•˜ê¸° ìœ„í•œ JwtDecoder ë¹ˆì´ í•„ìš”í•˜ë‹¤
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000074.png`} />