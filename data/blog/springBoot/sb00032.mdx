---
title: 'ğŸ§©[ìŠ¤í”„ë§ ì‹œíë¦¬í‹° OAuth2] OAuth 2.0 Authorization Server Fundamentals'
date: 2025-09-08
tags: ['springboot', 'spring-security', 'authorization-server']
draft: false
layout: PostSimple
---

# ëª©ì°¨

<TOCInline toc={props.toc} exclude="ëª©ì°¨"/>

---

# 1. OAuth 2.0 Authorization Server ì†Œê°œ

## âœ“ ì†Œê°œ

- Spring Authorization ServerëŠ” OAuth 2.1 ë° OpenID Connect 1.0 ì‚¬ì–‘ ë° ê¸°íƒ€ ê´€ë ¨ ì‚¬ì–‘ì˜ êµ¬í˜„ì„ ì œê³µí•˜ëŠ” í”„ë ˆì„ì›Œí¬
- OpenID Connect 1.0 ê³µê¸‰ì ë° OAuth2 ê¶Œí•œ ë¶€ì—¬ ì„œë²„ ì œí’ˆì„ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ì•ˆì „í•˜ê³  ê°€ë³ê³  ì‚¬ìš©ì ì§€ì • ê°€ëŠ¥í•œ ê¸°ë°˜ì„ ì œê³µí•˜ê¸° ìœ„í•´ êµ¬ì¶•ë¨.

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000039.png`} />

## âœ“ í”„ë¡œì íŠ¸ êµ¬ì„±

- Spring Boot 2.7.x ë²„ì „
- JDK 11 ì´ìƒ
- Gradle ë¹Œë“œ

## âœ“ ì˜ì¡´ì„± ì¶”ê°€

```groovy
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.security:spring-security-oauth2-authorization-server:0.3.1'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
}
```

# 2. ì´ˆê¸°í™” ê³¼ì • ì´í•´

## 2-1. OAuth2AuthorizationServerConfiguration

### âœ“ ì•„í‚¤í…ì²˜

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000040.png`} />

### âœ“ ì†Œê°œ

- OAuth2 ì¸ê°€ ì„œë²„ì— ëŒ€í•œ ìµœì†Œ ê¸°ë³¸ êµ¬ì„±ì„ ì œê³µí•˜ëŠ” ì„¤ì • í´ë˜ìŠ¤ì´ë‹¤
- OAuth2AuthorizationServerConfigurerë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ êµ¬ì„±ì„ ì ìš©í•˜ê³  OAuth2 ì¸ê°€ ì„œë²„ë¥¼ ì§€ì›í•˜ëŠ” ëª¨ë“  ì¸í”„ë¼ êµ¬ì„± ìš”ì†Œë¡œ êµ¬ì„±ëœ SecurityFilterChain ë¹ˆì„ ë“±ë¡í•œë‹¤
```java
@Configuration(proxyBeanMethods = false)
public class OAuth2AuthorizationServerConfiguration {

    @Bean
    @Order(Ordered.HIGHEST_PRECEDENCE)
    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
        applyDefaultSecurity(http); // ì¸ê°€ì„œë²„ì˜ ê¸°ë³¸ ë³´ì•ˆ êµ¬ì„±ì„ ì‘ë™ì‹œí‚¤ë©° ì‹œíë¦¬í‹°ì˜ í•„í„°ì²´ì¸ì„ í˜•ì„±í•œë‹¤
        return http.build();
    }
    
    public static void applyDefaultSecurity(HttpSecurity http) throws Exception {
        OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer = new OAuth2AuthorizationServerConfigurer<>();
        RequestMatcher endpointsMatcher = authorizationServerConfigurer.getEndpointsMatcher(); // ì¸ê°€ì„œë²„ì˜ ì—”ë“œí¬ì¸íŠ¸ ìš”ì²­ ë§¤ì²˜ ì„ ì–¸
        
        http
            .requestMatcher(endpointsMatcher) // ì¸ê°€ì„œë²„ë¡œ ì˜¤ëŠ” ìš”ì²­ì´ endpointsMatcher ì™€ ë§¤ì¹­ë˜ë©´ ì¸ì¦&ì¸ê°€ í”„ë¡œì„¸ìŠ¤ê°€ ì‘ë™ëœë‹¤
            .authorizeRequests(authorizeRequests -> authorizeRequests.anyRequest().authenticated() )
            .csrf(csrf -> csrf.ignoringRequestMatchers(endpointsMatcher)) // endpointsMatcher ì™€ ë§¤ì¹­ë˜ëŠ” ìš”ì²­ì— í•œí•´ csrf ê¸°ëŠ¥ì´ ë¬´ì‹œëœë‹¤
            .apply(authorizationServerConfigurer); // OAuth2AuthorizationServerConfigurer ë¥¼ ì„¤ì • ì´ˆê¸°í™” í´ë˜ìŠ¤ë¡œ ë“±ë¡í•œë‹¤
    }
}
```

- OpenID Connect 1.0 UserInfo ì—”ë“œí¬ì¸íŠ¸ ë° OpenID Connect 1.0 í´ë¼ì´ì–¸íŠ¸ ë“±ë¡ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ í•„ìˆ˜ìš”ì†Œì¸ JwtDecoder ë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤
```java
@Bean
public JwtDecoder jwtDecoder(JWKSource<SecurityContext> jwkSource) {
	return OAuth2AuthorizationServerConfiguration.jwtDecoder(jwkSource);
}
```

### âœ“ OAuth2 ì¸ê°€ ì„œë²„ êµ¬ì„± ë°©ì‹

<b>1. @Import(OAuth2AuthorizationServerConfiguration.class) ì„ ì–¸</b>

```java
@Configuration
@Import(OAuth2AuthorizationServerConfiguration.class)
public class AuthorizationServerConfig {

	@Bean
	public RegisteredClientRepository registeredClientRepository() {
		List<RegisteredClient> registrations = ...
		
		return new InMemoryRegisteredClientRepository(registrations);
	}
	
	@Bean
	public JWKSource<SecurityContext> jwkSource() {
		RSAKey rsaKey = ...
		JWKSet jwkSet = new JWKSet(rsaKey);
		
		return (jwkSelector, securityContext) -> jwkSelector.select(jwkSet);
	}
	
}
```

<b>2. OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(HttpSecurity) í˜¸ì¶œ</b>

```java
@Configuration(proxyBeanMethods = false)
public class AuthorizationServerConfig {

	@Bean
	@Order(Ordered.HIGHEST_PRECEDENCE)
	public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
		OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
```

<b>3. ì‚¬ìš©ì ì •ì˜ êµ¬ì„±</b>

- OAuth2AuthorizationServerConfigurerëŠ” OAuth2 ì¸ì¦ ì„œë²„ì˜ ë³´ì•ˆ êµ¬ì„±ì„ ì™„ì „íˆ ì‚¬ìš©ì ì •ì˜í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤
- ì´ë¥¼ í†µí•´ RegisteredClientRepository, OAuth2AuthorizationService, OAuth2TokenGenerator ë“±ê³¼ ê°™ì´ í•µì‹¬ êµ¬ì„± ìš”ì†Œë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
- ë˜í•œ ê¶Œí•œ ë¶€ì—¬ ì—”ë“œí¬ì¸íŠ¸, í† í° ì—”ë“œí¬ì¸íŠ¸, í† í° ê²€ì‚¬ ì—”ë“œí¬ì¸íŠ¸ ë“±ê³¼ ê°™ì€ í”„ë¡œí† ì½œ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ìš”ì²­ ì²˜ë¦¬ ë…¼ë¦¬ë¥¼ ì‚¬ìš©ì ì •ì˜í•  ìˆ˜ ìˆë‹¤.
- OAuth2 Authorization ServerConfigurerëŠ” ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„± ì˜µì…˜ì„ ì œê³µí•œë‹¤.
```java
@Configuration
public class AuthorizationServerConfig {

	@Bean
	public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
		
		OAuth2AuthorizationServerConfigurer<HttpSecurity> authorizationServerConfigurer = new OAuth2AuthorizationServerConfigurer<>();
		http.apply(authorizationServerConfigurer);
		
		authorizationServerConfigurer
			.registeredClientRepository(registeredClientRepository)
			.authorizationService(authorizationService)
			.authorizationConsentService(authorizationConsentService)
			.providerSettings(providerSettings)
			.tokenGenerator(tokenGenerator)
			.clientAuthentication(clientAuthentication -> { })
			.authorizationEndpoint(authorizationEndpoint -> { })
			.tokenEndpoint(tokenEndpoint -> { })
			.tokenIntrospectionEndpoint(tokenIntrospectionEndpoint -> { })
			.tokenRevocationEndpoint(tokenRevocationEndpoint -> { })
			.oidc(oidc -> oidc
				.userInfoEndpoint(userInfoEndpoint -> { })
				.clientRegistrationEndpoint(clientRegistrationEndpoint -> { })
			);
			
		return http.build();
	}
	
}
```

## 2-2. OAuth2AuthorizationServerConfigurer

### âœ“ OAuth2AuthorizationServerConfigurer

- OAuth 2.0 Authorization Server ì§€ì›ì„ ìœ„í•œ ì„¤ì • í´ë˜ìŠ¤ë¡œì„œ ì‚¬ì–‘ì— ë”°ë¥¸ ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •, í•„í„°, í”„ë¡œë°”ì´ë” ë“±ì˜ ì´ˆê¸°í™” ì‘ì—…ì´ ì´ë£¨ì–´ì§„ë‹¤.

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000041.png`} />
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000042.png`} />

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000043.png`} />
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000044.png`} />

## 2-3. ProviderContext (0.4.x ì´í›„:  â–¶ï¸ AuthorizationServerContext))

### âœ“ ProviderContext (â–¶ï¸ AuthorizationServerContext))

- ê³µê¸‰ìì— ëŒ€í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì»¨í…ìŠ¤íŠ¸ ê°ì²´ë¡œì„œ ê³µê¸‰ì ì„¤ì • ë° í˜„ì¬ issuer ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•œë‹¤

### âœ“ ProviderContextHolder (â–¶ï¸ AuthorizationServerContextHolder)

- ProviderContext ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©° ThreadLocal ì„ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ìš”ì²­ ìŠ¤ë ˆë“œì™€ ì—°ê²°ë˜ì–´ ìˆëŠ” ProviderContext ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•œë‹¤

### âœ“ ProviderContextFilter (â–¶ï¸ AuthorizationServerContextFilter))

- ProviderContextHolderì™€ ProviderContextë¥¼ ì—°ê²°í•œë‹¤
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000045.png`} />

# 3. AuthenticationEntryPoint

<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000046.png`} />

# 4. ì‹œì‘í•˜ê¸°

## âœ“ ê°œìš”

- OAuth 2.0 Authorization Server ì˜ ê¶Œí•œ ë¶€ì—¬ íë¦„ì— ëŒ€í•œ ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ ê°„ë‹¨í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“ ë‹¤.
- í´ë¼ì´ì–¸íŠ¸ëŠ” Postman ì„ ì‚¬ìš©í•˜ê³  ì¸ê°€ì„œë²„ì˜ ì—”ë“œí¬ì¸íŠ¸ë¡œ ê¶Œí•œë¶€ì—¬ ìš”ì²­ ë° ì‘ë‹µì„ í™•ì¸í•œë‹¤

## âœ“ AuthorizationServerConfig ìƒì„±

- OAuth 2.0 Authorization Server ì§€ì›ì„ ìœ„í•œ ì„¤ì • í´ë˜ìŠ¤ë¡œì„œ ì—”ë“œí¬ì¸íŠ¸ì™€ ì¸ì¦ì„ ìœ„í•œ ì‹œíë¦¬í‹° í•„í„°ì²´ì¸ì„ êµ¬ì„±í•œë‹¤
<img src={`${process.env.BASE_PATH}/static/images/springBoot/image00000047.png`} />

## âœ“ SecurityConfig ìƒì„±

- ì¸ê°€ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ê¶Œí•œ ë¶€ì—¬ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ë¦¬ì†ŒìŠ¤ ì†Œìœ ìì˜ ì¸ì¦ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬ì„±í•´ì•¼ í•œë‹¤
- OAuth 2.0 Authorization Server ë¡œ ì ‘ì†í•˜ëŠ” ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì¸ì¦ & ì¸ê°€ ì •ì±…ë¥¼ ì„¤ì •í•˜ëŠ” í´ë˜ìŠ¤
- ê¸°ë³¸ ì‚¬ìš©ì ê³„ì •ì„ ìƒì„±í•œë‹¤
```java
@EnableWebSecurity
public class DefaultSecurityConfig {

	@Bean
	SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
		http
			.authorizeRequests(authorizeRequests ->
				authorizeRequests.anyRequest().authenticated() // ì‚¬ìš©ìì˜ ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ì„ ë°›ì•„ì•¼ ìì› ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤
			)
			.formLogin(withDefaults()); // ì¸ì¦ì€ í¼ ì¸ì¦ ë°©ì‹ìœ¼ë¡œ ì„¤ì •í•œë‹¤
			
		return http.build();
	}
	
	@Bean
	UserDetailsService users() {
		UserDetails user = User.builder()
			.username("user")
			.password("pass")
			.roles("USER")
			.build();
			
		return new InMemoryUserDetailsManager(user);
	}
	
}
```

## âœ“ í´ë¼ì´ì–¸íŠ¸ êµ¬ì„±

- í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì€ OAuth 2.0 Authorization Code Grant íƒ€ì…ìœ¼ë¡œ í•œë‹¤
- OpenID Connect ê°€ ì‹¤í–‰ë˜ë„ë¡ scope ì— openid ê°€ í¬í•¨ë˜ë„ë¡ í•œë‹¤
- í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ë°©ë²•ì€ Basic ìœ¼ë¡œ í•œë‹¤
- í´ë¼ì´ì–¸íŠ¸ RedirectUri ëŠ” http://127.0.0.1:8080 ë¡œ í•œë‹¤